# NotebookLM 連携ガイド

本アプリとNotebookLMを連携させて、高品質な完成スライドを生成するフローです。

## アーキテクチャ

```
┌─────────────────────────────────────────────────────────────────┐
│                        本アプリ                                  │
│  ┌─────────────┐   ┌─────────────┐   ┌─────────────────────┐   │
│  │ 思考整理    │ → │ ソース生成  │ → │ 完成スライド表示    │   │
│  │ (章・台本)  │   │ (フォーマット変換) │   │ (16:9/ノート形式DL) │   │
│  └─────────────┘   └─────────────┘   └─────────────────────┘   │
│                          │                     ↑                │
└──────────────────────────│─────────────────────│────────────────┘
                           │                     │
                           ↓                     │
┌─────────────────────────────────────────────────────────────────┐
│                      NotebookLM                                  │
│  ┌─────────────┐   ┌─────────────┐   ┌─────────────────────┐   │
│  │ 常設プログラム │   │ ソース追加  │ → │ スライド生成        │   │
│  │ (役割定義)  │   │ (本アプリから) │   │ (16:9 完成品質)     │   │
│  └─────────────┘   └─────────────┘   └─────────────────────┘   │
│                                              │                   │
│                                              ↓                   │
│                                       PNG出力 → ZIP化            │
└─────────────────────────────────────────────────────────────────┘
```

## セットアップ（初回のみ）

### 1. NotebookLMに常設ノートブックを作成

- **ノートブック名**: `Lecture Sync App｜完成スライド生成エンジン`
- **URL**: https://notebooklm.google.com/notebook/2b468568-e7a5-4fc3-8118-512e215675a4

### 2. 常設プログラム（役割定義）をソースとして追加

以下のテキストを最初のソースとして追加（変更しない）:

```
【常設プログラム：Lecture Sync App 完成スライド生成エンジン】

あなたは「講座・セミナー用 完成スライド制作の専門エンジン」です。

■目的
与えられた内容を、講師がそのまま登壇で使える
- 16:9 横長
- 視認性が高く
- 情報が整理された
- 日本語表示が美しい
完成スライドとして生成してください。

■ルール
1. 1スライド = 1テーマ
2. テキストは詰め込まない
3. 見出しは短く、要点は箇条書き
4. 図解・レイアウト・強調を積極的に使う
5. 話す内容（スピーカーノート）はスライド本文に書かない
6. スライドは「完成品」として、そのまま投影できる品質にする

■入力について
この後に追加されるソースは「講座作成アプリから渡される、スライド生成用に整形された原稿」です。
以下のような構造を理解して処理してください：
- TITLE: 講座タイトル
- CHAPTER: 章タイトル
- SECTION: 小見出しタイトル
- SLIDE GOAL: この小見出しで伝えたい結論
- KEY POINTS: 要点（箇条書き）
- DETAIL: 具体例・数字・根拠
- SPEAKER NOTES SUMMARY: 話す内容の要約

■出力
スライド形式で出力してください。
```

## 運用フロー

### Step 1: 本アプリでソースを生成

1. 本アプリの「表紙」画面を開く
2. 「NotebookLM 連携」セクションの「ソースをコピー」をクリック
3. クリップボードにNotebookLM投入用テキストがコピーされる

### Step 2: NotebookLMにソースを追加

1. 「NotebookLM」ボタンをクリック（または直接アクセス）
2. 左側の「+ ソースを追加」をクリック
3. 「コピーしたテキスト」を選択
4. 本アプリからコピーしたテキストを貼り付け
5. 「挿入」をクリック

### Step 3: スライドを生成

1. NotebookLMの右側「Studio」パネルで「スライド...」をクリック
2. スライド生成を実行
3. 生成されたスライドを確認

### Step 4: スライドをエクスポート

1. 各スライドをPNGとしてダウンロード
2. ファイル名を `001.png`, `002.png`, ... の形式に変更
3. すべてのPNGを1つのZIPファイルにまとめる

### Step 5: 本アプリにインポート

1. 本アプリの「表紙」画面に戻る
2. 「NotebookLM 連携」セクションの「ZIPファイルを選択」をクリック
3. 作成したZIPファイルを選択
4. スライドが自動的に取り込まれる

## NotebookLM投入用フォーマット

本アプリが生成するソーステキストの形式:

```
TITLE: {講座タイトル}
CHAPTER: {章タイトル}
SECTION: {小見出しタイトル}

SLIDE GOAL:
- {この小見出しで伝えたい結論}

KEY POINTS:
- {要点1}
- {要点2}
- {要点3}

DETAIL:
- {具体例}
- {数字・根拠}

SPEAKER NOTES SUMMARY:
{話す内容の要約（3〜6行）}

---

(次のセクション...)
```

## 自動化フロー（Claude in Chrome）

将来的には、Claude in Chromeを使って以下の操作を自動化可能:

```
1. NotebookLMノートブックを開く
   - URL: NOTEBOOKLM_NOTEBOOK_URL

2. ソースを追加
   - 「+ ソースを追加」をクリック
   - 「コピーしたテキスト」を選択
   - 本アプリのソーステキストを貼り付け
   - 「挿入」をクリック

3. スライド生成
   - Studioパネルの「スライド...」をクリック
   - 生成完了を待機

4. PNG取得
   - 各スライドをスクリーンショット or ダウンロード
   - 001.png, 002.png... の形式で保存

5. ZIP化して返却
   - PNGをZIPにまとめる
   - 本アプリの /api/import-notebooklm にPOST
```

**重要**: NotebookLMのAPIは使用せず、UI操作のみで完結させる。

## 関連ファイル

- `/lib/notebooklmUtils.ts` - ソース生成ユーティリティ
- `/app/api/import-notebooklm/route.ts` - ZIPインポートAPI
- `/lib/types.ts` - `sourceType: 'app' | 'notebooklm'` の定義
- `/components/editor/DeckModal.tsx` - NotebookLMスライドのフル表示

## トラブルシューティング

### Q: スライドが表示されない
A: `sourceType === 'notebooklm'` かつ `pngDataUrl` が設定されていることを確認

### Q: ZIPインポートでエラー
A: ZIPファイル内にPNG画像が含まれていることを確認。
   ファイル名は `.png` で終わる必要があります。

### Q: 文字化けする
A: NotebookLMで日本語フォントが正しく設定されていることを確認
